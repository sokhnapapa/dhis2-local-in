
<html>
	    <head>
		        <title>Cumulative Routine Reports</title>
        		
		        <script>
		            //Global Variables
		            
					var reportModels = new HashTable();
					var reportFileNames = new HashTable();
					var periodTypeIds = new HashTable();

		            // OrganisationUnit ids and its Names
			            ##var orgUnits = new HashTable();
			            ##foreach($orgUnit in $organisationUnits)
			            ##    var orgUnitId = ""+$orgUnit.getId();
			            ##    orgUnits.put(orgUnitId,"$orgUnit.getShortName()");
			            ##end
			            
			            // OrganisationUnit ids and its Level
			            ##var orgUnitLevels = new HashTable();
			            ##foreach($orgUnit in $organisationUnits)
			            ##    var orgUnitId = ""+$orgUnit.getId();
			            ##    orgUnitLevels.put(orgUnitId,"$organisationUnitService.getLevelOfOrganisationUnit( $orgUnit )");
			            ##end
			            
			            function formValidations()
			            {			            			                
			                var periodTypeIndex = document.reportForm.periodTypeId.selectedIndex;
			                var orgunitIdValue = document.reportForm.ouIDTB.value;
							var reportListIndex = document.reportForm.reportList.selectedIndex;
														
                            var startDateValue = document.reportForm.startDate.value;
                            var endDateValue = document.reportForm.endDate.value;
			                
							if(document.reportForm.periodTypeId.options[periodTypeIndex].text == null || document.reportForm.periodTypeId.options[periodTypeIndex].text== "" || document.reportForm.periodTypeId.options[periodTypeIndex].text== "[ Select PeriodType ]") {alert("Please Select A Period Type"); return false;}
							else if(orgunitIdValue == null || orgunitIdValue=="" || orgunitIdValue==" ") {alert("Please Select OrganisationUnit"); return false;}    
							else if(reportListIndex < 0 || document.reportForm.reportList.options[reportListIndex].text == null) {alert("Please Select a Report"); return false;}            	
							else if(startDateValue == null || startDateValue== "" || endDateValue == null || endDateValue=="") {alert("Please Select Start Date And End Date"); return false;}
                            else if(startDateValue > endDateValue) {alert("Start Date Is Greater Than End Date"); return false;}		
										                
							document.reportForm.reportModelTB.value = reportModels.get(document.reportForm.reportList.options[reportListIndex].value);
							document.reportForm.reportFileNameTB.value = reportFileNames.get(document.reportForm.reportList.options[reportListIndex].value);
							document.reportForm.periodTypeIdTB.value = periodTypeIds.get(document.reportForm.periodTypeId.value);
                            document.forms['reportForm'].submit();
			                //return true;
			            }

//-----------------------------------------------------------------------
//init jQuery validation for reportForm
//@added validation for all fields and additional rules alphanumericwithbasicpuncspaces, date and url.
//-----------------------------------------------------------------------
	jQuery(document).ready(
			function()
			{
				jQuery("#reportForm").validate({
					  meta:"validate"
					,errorElement:"td"
					,submitHandler: function(form)
									{
										formValidations();
									}
				});
				jQuery.validator.loadLocaled( jQuery("#curLocaleCode").val() );
				jQuery("#name").focus();
			}
	);
	
			        </script>
	    </head>
	    <body>
	        <h1>Aggregation Reports Analyser</h1>
	        <hr />	
	        <br />
	        <form id="reportForm" name="reportForm" action="generateCumulativeRoutineReport.action" method="post" target="_blank">
            <input type="hidden" id="curLocaleCode" value="$locale.getLanguage()_$locale.getCountry()"/>
            <table align="center" style=" border-collapse: collapse; margin-top: 0;" cellpadding="0" cellspacing="0" width="730" border=0>		                
		         <tr>
                      <td class="NormalB">
                    			    PeriodType : <br />
                    			    <select id="periodTypeId" name="periodTypeId" style="width:200px" onchange="getPeriodsForCumulative()">
                            				<option value="NA">[ Select PeriodType ]</option>
                            				#foreach ( $type in $periodTypes )
                                					<option value="$type.name">$type.name</option>
                            				#end
                        			</select>
					  </td>
                      <td class="NormalB">                            
                        OrganisationUnit : <br />
                        <input type="text" name="ouNameTB" id="ouNameTB" size="20" disabled>         
                      </td>
				  </tr>
                  <tr>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                  </tr>
                  <tr>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                  </tr>	
				  <tr>
                        <td class="NormalB">
                            <label for="startDate">$i18n.getString( 'start_date' ) ($i18n.getString( "format.date.label" ))</label><br/>
                            <input type="text" id="startDate" name="startDate" onChange="if(!isDate( this.value )) this.value='';" style="width:20em" class="{validate:{required:true,dateISO:true}}">
                            <img src="../images/calendar_icon.gif" width="16" height="16" id="getStartDate" cursor: pointer;" title="$i18n.getString( "date_selector" )" onmouseover="this.style.background='orange';" onmouseout="this.style.background=''">
                        </td>
                            <td class="NormalB">
                            <label for="endDate">$i18n.getString( 'end_date' ) ($i18n.getString( "format.date.label" ))</label><br />
                            <input type="text" id="endDate" name="endDate" onChange="if(!isDate( this.value )) this.value='';" style="width:20em" class="{validate:{required:true,dateISO:true}}">
                            <img src="../images/calendar_icon.gif" width="16" height="16" id="getEndDate" cursor: pointer;" title="$i18n.getString( "date_selector" )" onmouseover="this.style.background='orange';" onmouseout="this.style.background=''">
                        </td>
				  </tr>
				  <tr>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                  </tr>
                  <tr>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                  </tr> 
                  <tr>         
                        <td class="NormalB">
                                    Reports :<br />
                                    <select id="reportList" name="reportList" style="width:200px"></select>
                        </td>
					    <td>
                          <input type="checkbox" id="aggCB" name="aggCB" checked> Aggregated Data
                          <br><br>                              
                          <input type="submit" name="generate" value="Generate Report" disabled="disabled"/>
						  <input type="hidden" name="autogen" id="autogen" value="0" >
						  <input type="hidden" name="periodTypeIdTB" id="periodTypeIdTB">
                          <input type="hidden" name="ouIDTB" id="ouIDTB">
                          <input type="hidden" name="ouLevelTB" id="ouLevelTB">
                          <input type="hidden" name="reportModelTB" id="reportModelTB">
                          <input type="hidden" name="reportFileNameTB" id="reportFileNameTB">
                          <input type="hidden" name="reportListFileNameTB" id="reportListFileNameTB" value="goiReportsList.xml">
                        </td>
                  </tr>
            </table>
        </form>
		<script type="text/javascript">
    
    Calendar.setup({
        inputField     :    "startDate",      // id of the input field
        ifFormat       :    "$i18n.getString("format.date.label")",       // format of the input field
        button         :    "getStartDate"   // trigger for the calendar (button ID)
    });
    
    Calendar.setup({
        inputField     :    "endDate",      // id of the input field
        ifFormat       :    "$i18n.getString("format.date.label")",       // format of the input field
        button         :    "getEndDate"   // trigger for the calendar (button ID)
    });
</script>
	    </body>
	</html>        